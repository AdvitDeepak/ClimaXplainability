seed_everything: 42

# # ---------------------------- TRAINER -------------------------------------------
# trainer:
#   default_root_dir: ${oc.env:AMLT_OUTPUT_DIR,/mnt/climate_pretraining/outputs/vit}

#   precision: 16

#   gpus: null
#   num_nodes: 1
#   accelerator: gpu
#   strategy: ddp_find_unused_parameters_false

#   min_epochs: 1
#   max_epochs: 20
#   enable_progress_bar: true

#   sync_batchnorm: True
#   enable_checkpointing: True
#   resume_from_checkpoint: null

#   # debugging
#   fast_dev_run: false

trainer:
  max_epochs: 5
  accelerator: gpu
  devices: 1
  callbacks:
    - class_path: ModelCheckpoint
      init_args:
        save_last: true
        verbose: false
        filename: "epoch_{epoch:03d}"
        auto_insert_metric_name: false
    - class_path: RichModelSummary
      init_args:
        max_depth: -1
    - class_path: RichProgressBar
  
  # class_path: climate_learn.training.Trainer
  # init_args:
    

data:
  class_path: src.climate_learn.data.DataModule
  init_args:
    data_module_args: 
      class_path: src.climate_learn.data_module.DataModuleArgs
      init_args:
        task_args:
          class_path: src.climate_learn.data_module.tasks.args.ForecastingArgs
          init_args: 
            dataset_args:
              class_path: src.climate_learn.data_module.data.args.ERA5Args
              init_args:
                root_dir: /data0/datasets/weatherbench/data/weatherbench/era5/5.625deg/
                variables: 
                  - 2m_temperature
                years:
                  - 2015
            in_vars:
              - 2m_temperature
            out_vars:
              - 2m_temperature
        train_start_year: 2005
        val_start_year: 2015
        test_start_year: 2016
        end_year: 2018
    batch_size: 128
    num_workers: 1

    # ERA5
    # task: forecasting
    # root_dir: /data0/datasets/weatherbench/data/weatherbench/era5/5.625deg/
    # in_vars:
    #   - 2m_temperature
    # out_vars:
    #   - 2m_temperature
    # train_start_year: 2005
    # val_start_year: 2015
    # test_start_year: 2016
    # end_year: 2018
    # pred_range: 
    #   class_path: src.climate_learn.utils.datetime.Days
    #   init_args:
    #     value: 3
    # subsample:
    #   class_path: src.climate_learn.utils.datetime.Hours
    #   init_args:
    #     value: 6
    # batch_size: 128
    # num_workers: 1

model:
  class_path: src.climate_learn.models.modules.ForecastLitModule
  init_args:
    net:
      class_path: src.climate_learn.models.components.ResNet
      init_args:
        in_channels: 1
        out_channels: 1
        n_blocks: 4
    optimizer: torch.optim.RMSprop
    lr: 1e-4
    weight_decay: 1e-5
    warmup_epochs: 1
    max_epochs: 5
